!function(e){e(["jquery"],function(e){return e.fn.blurjs=function(t){function a(e,t,a,c,o,n){if(!(isNaN(n)||1>n)){n|=0;var i,l=e.getContext("2d");try{try{i=l.getImageData(t,a,c,o)}catch(f){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),i=l.getImageData(t,a,c,o)}catch(f){throw alert("Cannot access local image"),new Error("unable to access local image data: "+f)}}}catch(f){throw alert("Cannot access image"),new Error("unable to access image data: "+f)}var h,d,u,m,b,p,x,y,v,I,C,w,k,S,P,j,K,A,D,E,U=i.data,z=n+n+1,R=c-1,Z=o-1,N=n+1,q=N*(N+1)/2,B=new r,L=B;for(u=1;z>u;u++)if(L=L.next=new r,u==N)var M=L;L.next=B;var O=null,Q=null;x=p=0;var $=g[n],F=s[n];for(d=0;o>d;d++){for(S=P=j=y=v=I=0,C=N*(K=U[p]),w=N*(A=U[p+1]),k=N*(D=U[p+2]),y+=q*K,v+=q*A,I+=q*D,L=B,u=0;N>u;u++)L.r=K,L.g=A,L.b=D,L=L.next;for(u=1;N>u;u++)m=p+((u>R?R:u)<<2),y+=(L.r=K=U[m])*(E=N-u),v+=(L.g=A=U[m+1])*E,I+=(L.b=D=U[m+2])*E,S+=K,P+=A,j+=D,L=L.next;for(O=B,Q=M,h=0;c>h;h++)U[p]=y*$>>F,U[p+1]=v*$>>F,U[p+2]=I*$>>F,y-=C,v-=w,I-=k,C-=O.r,w-=O.g,k-=O.b,m=x+((m=h+n+1)<R?m:R)<<2,S+=O.r=U[m],P+=O.g=U[m+1],j+=O.b=U[m+2],y+=S,v+=P,I+=j,O=O.next,C+=K=Q.r,w+=A=Q.g,k+=D=Q.b,S-=K,P-=A,j-=D,Q=Q.next,p+=4;x+=c}for(h=0;c>h;h++){for(P=j=S=v=I=y=0,p=h<<2,C=N*(K=U[p]),w=N*(A=U[p+1]),k=N*(D=U[p+2]),y+=q*K,v+=q*A,I+=q*D,L=B,u=0;N>u;u++)L.r=K,L.g=A,L.b=D,L=L.next;for(b=c,u=1;n>=u;u++)p=b+h<<2,y+=(L.r=K=U[p])*(E=N-u),v+=(L.g=A=U[p+1])*E,I+=(L.b=D=U[p+2])*E,S+=K,P+=A,j+=D,L=L.next,Z>u&&(b+=c);for(p=h,O=B,Q=M,d=0;o>d;d++)m=p<<2,U[m]=y*$>>F,U[m+1]=v*$>>F,U[m+2]=I*$>>F,y-=C,v-=w,I-=k,C-=O.r,w-=O.g,k-=O.b,m=h+((m=d+N)<Z?m:Z)*c<<2,y+=S+=O.r=U[m],v+=P+=O.g=U[m+1],I+=j+=O.b=U[m+2],O=O.next,C+=K=Q.r,w+=A=Q.g,k+=D=Q.b,S-=K,P-=A,j-=D,Q=Q.next,p+=c}l.putImageData(i,t,a)}}function r(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var c=document.createElement("canvas"),o=!1,n=e(this).selector.replace(/[^a-zA-Z0-9]/g,"");if(c.getContext){t=e.extend({source:"body",radius:5,overlay:"",offset:{x:0,y:0},optClass:"",cache:!1,cacheKeyPrefix:"blurjs-",draggable:!1,debug:!1},t);var g=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],s=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return this.each(function(){var r=e(this),g=e(t.source),s=g.css("backgroundImage").replace(/"/g,"").replace(/url\(|\)$/gi,"");ctx=c.getContext("2d"),tempImg=new Image,tempImg.onload=function(){if(o)var e=tempImg.src;else{c.style.display="none",c.width=tempImg.width,c.height=tempImg.height,ctx.drawImage(tempImg,0,0),a(c,0,0,c.width,c.height,t.radius),0!=t.overlay&&(ctx.beginPath(),ctx.rect(0,0,tempImg.width,tempImg.width),ctx.fillStyle=t.overlay,ctx.fill());var e=c.toDataURL();if(t.cache)try{t.debug&&console.log("Cache Set"),localStorage.setItem(t.cacheKeyPrefix+n+"-"+s+"-data-image",e)}catch(i){console.log(i)}}var l=g.css("backgroundAttachment"),f="fixed"==l?"":"-"+(r.offset().left-g.offset().left-t.offset.x)+"px -"+(r.offset().top-g.offset().top-t.offset.y)+"px";r.css({"background-image":'url("'+e+'")',"background-repeat":g.css("backgroundRepeat"),"background-position":f,"background-attachment":l}),0!=t.optClass&&r.addClass(t.optClass),t.draggable&&(r.css({"background-attachment":"fixed","background-position":"0 0"}),r.draggable())},Storage.prototype.cacheChecksum=function(e){var a="";for(var r in e){var c=e[r];a+="[object Object]"==c.toString()?(c.x.toString()+c.y.toString()+",").replace(/[^a-zA-Z0-9]/g,""):(c+",").replace(/[^a-zA-Z0-9]/g,"")}var o=this.getItem(t.cacheKeyPrefix+n+"-"+s+"-options-cache");o!=a&&(this.removeItem(t.cacheKeyPrefix+n+"-"+s+"-options-cache"),this.setItem(t.cacheKeyPrefix+n+"-"+s+"-options-cache",a),t.debug&&console.log("Settings Changed, Cache Emptied"))};var i=null;t.cache&&(localStorage.cacheChecksum(t),i=localStorage.getItem(t.cacheKeyPrefix+n+"-"+s+"-data-image")),null!=i?(t.debug&&console.log("Cache Used"),o=!0,tempImg.src=i):(t.debug&&console.log("Source Used"),tempImg.src=s)})}},e})}("function"==typeof define&&define.amd?define:function(e,t){t(jQuery)});